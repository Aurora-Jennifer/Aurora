[tool:pytest]
markers =
    flaky: marks tests as flaky (may fail intermittently)
    network: marks tests as requiring network access
    perf: marks tests as performance tests
    slow: marks tests as slow running (>30s)
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    data_sanity: marks tests as data sanity validation tests
    property: marks tests as property-based tests
    falsification: marks tests as falsification scenarios
    edge_case: marks tests as edge case handling
    contract: marks tests as contract validation
    guard: marks tests as guard enforcement
    corruption: marks tests as data corruption scenarios
    repair: marks tests as data repair functionality
    validation: marks tests as data validation logic
    benchmark: marks tests as performance benchmarks
    stress: marks tests as stress testing scenarios
    regression: marks tests as regression testing
    smoke: marks tests as smoke tests
    e2e: marks tests as end-to-end tests
    quarantine: known failing or flaky test (non-blocking in CI)
    acceptance: marks tests as acceptance tests
    memory: marks tests as memory usage tests
    meta: marks tests as metamorphic tests
    table_driven: marks tests as table-driven tests
    yaml: marks tests as YAML-based tests
    factory: marks tests as factory-based tests
    mutation: marks tests as mutation tests
    invariance: marks tests as invariance tests
    scale: marks tests as scale tests
    time: marks tests as time-based tests
    volume: marks tests as volume tests
    ohlc: marks tests as OHLC tests
    lookahead: marks tests as lookahead detection tests
    dtype: marks tests as data type tests
    missing: marks tests as missing data tests
    clean: marks tests as clean data tests
    failure: marks tests as failure case tests
    success: marks tests as success case tests
    large: marks tests as large dataset tests
    small: marks tests as small dataset tests
    constant: marks tests as constant value tests
    volatile: marks tests as volatile data tests
    decreasing: marks tests as decreasing price tests
    increasing: marks tests as increasing price tests
    zero: marks tests as zero value tests
    negative: marks tests as negative value tests
    extreme: marks tests as extreme value tests
    nan: marks tests as NaN value tests
    inf: marks tests as infinite value tests
    duplicate: marks tests as duplicate data tests
    monotonic: marks tests as monotonic data tests
    timezone: marks tests as timezone tests
    empty: marks tests as empty data tests
    single: marks tests as single row tests
    multi: marks tests as multi-row tests
    transform: marks tests as transformation tests
    permutation: marks tests as permutation tests
    additive: marks tests as additive invariance tests
    multiplicative: marks tests as multiplicative invariance tests
    scale_invariant: marks tests as scale invariance tests
    time_invariant: marks tests as time invariance tests
    volume_invariant: marks tests as volume invariance tests
    ohlc_invariant: marks tests as OHLC invariance tests
    monotonic_transform: marks tests as monotonic transformation tests

# Test discovery
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test*

# Output configuration
addopts =
    -v
    --tb=short
    --strict-markers
    --disable-warnings
    --color=yes
    --ignore=attic
    --ignore=attic_pending

# Performance test configuration (NEW)
# Generate performance logs for perf_gate.py
# Usage: pytest -m "perf or benchmark" -v > results/perf.log 2>&1

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning:matplotlib.*
    ignore::FutureWarning:pandas.*
